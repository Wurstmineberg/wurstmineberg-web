<!DOCTYPE html>
<html>
<head>
    <!--#include file="/static/html/header.html" -->
</head>
<body>
    <!--#include file="/static/html/navigation.html" -->
    
    <div class="container">
        <div class="panel panel-default">
            <div class="panel-heading">
                <h3 class="panel-title">All the people</h3>
            </div>
            <div class="panel-body">
                <p class="lead">Here's a list of all the people on the whitelist. Players are ranked in order of whitelisting.</p>
                <p>To keep player info updated, we kind of rely on the players themselves, so this info may be incomplete or nonsensical. Whoopsie.</p>
            </div>
        </div>
        <div class="table-responsive">
            <table class="table people-table">
                <tbody>
                    <tr>
                        <th id="founding-table" colspan="7"><h2 id="founding">Founding members</h2></th>
                    </tr>
                    <tr>
                        <th>&nbsp;</th>
                        <th>Name</th>
                        <th>Info</th>
                        <th>Minecraft</th>
                        <th>Twitter</th>
                        <th><a href="http://www.reddit.com/r/wurstmineberg/">Reddit</a></th>
                        <th>Website</th>
                    </tr>
                    <tr id="loading-founding-table" class="loading">
                        <td colspan="7">Is this thing on?</td>
                    </tr>
                    <tr>
                        <th id="later-table" colspan="7"><h2 id="later">Later members</h2></th>
                    </tr>
                    <tr>
                        <th>&nbsp;</th>
                        <th>Name</th>
                        <th>Info</th>
                        <th>Minecraft</th>
                        <th>Twitter</th>
                        <th><a href="http://www.reddit.com/r/wurstmineberg/">Reddit</a></th>
                        <th>Website</th>
                    </tr>
                    <tr id="loading-later-table" class="loading">
                        <td colspan="7">This isn't working…</td>
                    </tr>
                    <tr>
                        <th id="former-table" colspan="7"><h2 id="former">Former members</h2></th>
                    </tr>
                    <tr>
                        <th>&nbsp;</th>
                        <th>Name</th>
                        <th>Info</th>
                        <th>Minecraft</th>
                        <th>Twitter</th>
                        <th><a href="http://www.reddit.com/r/wurstmineberg/">Reddit</a></th>
                        <th>Website</th>
                    </tr>
                    <tr id="loading-former-table" class="loading">
                        <td colspan="7">Do you even JavaScript?</td>
                    </tr>
                </tbody>
            </table>
        </div> <!-- table -->
    </div> <!-- /container -->

    <!--#include file="/static/html/footer.html" -->

<script>
    $.ajax('/assets/serverstatus/people.json', {
        dataType: 'json',
        error: function(request, status, error) {
            $('.loading').children('td').html('error: could not load people.json');
        },
        success: function(data) {
            data.forEach(function(person) {
                var personStatus = 'status' in person ? person['status'] : 'later';
                var name = 'name' in person ? person['name'] : person['id'];
                var minecraft = 'minecraft' in person ? person['minecraft'] : null;
                var description = 'description' in person ? '<td>' + person['description'] + '</td>' : '<td style="font-size: small; color: gray;">Hier könnte Ihre Beschreibung stehen! (To update your description, tell someone in <a href="irc://chat.freenode.net/#wurstmineberg">IRC</a>.)</td>' ;
                var twitter = 'twitter' in person ? '<a href="https://twitter.com/' + person['twitter'] + '">@' + person['twitter'] + '</a>' : '—';
                var reddit = 'reddit' in person ? '<a href="https://reddit.com/u/' + person['reddit'] + '">' + person['reddit'] + '</a>' : '—';
                var website = 'website' in person ? '<a href="' + person['website'] + '">' + url_domain(person['website']) + '</a>' : '—';
                $('#loading-' + personStatus).before('<tr id="' + person['id'] + '"><td class="avatar">&nbsp;</td><td class="text-info">' + name + '</td>' + description + '<td>' + (minecraft ? minecraft : '—') + '</td><td>' + twitter + '</td><td>' + reddit + '</td><td>' + website + '</td></tr>');
            });
            $('.loading').remove();
            data.forEach(function(person) {
                if ('minecraft' in person) {
                    var ava = '/assets/img/ava/' + person['minecraft'] + '.png';
                    $('#' + person['id'] + ' > .avatar').html('<img class="img-rounded" />');
                    $('#' + person['id'] + ' > .avatar > img').attr('src', ava).error(function() {
                        $('#' + person['id'] + ' > .avatar').html('&nbsp;');
                    });
                }
            });
        }
    });
</script>
</body>
</html>
